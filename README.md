# 暗仓 (Dark Pool) - 金融模拟交易游戏

## 项目简介

《暗仓》是一款多人在线金融模拟交易游戏，玩家扮演不同的市场角色（散户或操盘手），通过买卖股票、分析舆情等方式进行虚拟交易，体验金融市场中的信息不对称和博弈策略。

## 功能特点

- 多人在线实时交易
- 两种角色设定：散户和操盘手
- 实时股价波动模拟
- 舆情影响系统
- 做空机制
- 留言板交流系统
- 排行榜竞争机制

## 技术架构

### 核心组件

- **后端**: Python + Gradio
- **前端**: Gradio自动生成Web界面
- **数据存储**: 内存存储（单轮游戏生命周期）
- **部署**: 支持本地运行和网络共享

### 项目结构

```
darkpool/
├── app.py              # 主应用入口
├── backend.py          # 后端逻辑
├── requirements.txt    # Python依赖包列表
├── environment.yml     # Conda环境配置
├── README.md           # 项目说明文档
└── scripts/            # 功能模块目录
    ├── game_state.py   # 游戏状态管理
    ├── player_manager.py # 玩家管理
    ├── ui_manager.py   # 界面管理
    ├── admin_functions.py # 管理员功能
    └── news_system.py  # 新闻系统
```

## 快速开始

### 环境准备

#### 方法一：使用Conda（推荐）

```bash
# 创建并激活环境
conda env create -f environment.yml
conda activate darkpool

# 运行应用
python app.py
```

#### 方法二：使用pip

```bash
# 安装依赖
pip install -r requirements.txt

# 运行应用
python app.py
```

### 配置新闻系统API（可选）

新闻系统支持通过大型语言模型生成实时财经新闻。要启用此功能，请执行以下步骤：

1. 在项目根目录创建 `.env` 文件
2. 添加您的API密钥：
   ```
   DEEPSEEK_API_KEY=your_actual_api_key_here
   ```

如果没有API密钥，系统将自动使用内置的新闻模板。

### 启动应用

```bash
python app.py
```

启动后访问 `http://localhost:8001` 即可进入游戏界面。
调试控制台 `http://localhost:7001` 即可进入调试界面。

## 游戏规则

### 角色设定

1. **散户**: 普通投资者，信息获取能力较弱
2. **操盘手**: 专业投资者，拥有更多信息优势

### 交易机制

- 初始资金：每位玩家100,000元
- 交易费率：每次交易收取5%手续费
- 做空机制：最多可做空当前资金可购买股票数量的2倍
- 结算机制：游戏结束后按最终资产排名

### 舆情系统

- 玩家可花费5,000元购买舆情信息影响市场走势
- 操盘手的影响力度是散户的5倍
- 舆情影响有边界限制，不会无限增强

## 管理员功能

在游戏界面底部可展开管理员调试面板，提供以下功能：
- 强制开始游戏
- 跳过1小时
- 跳至游戏结束
- 重新开始游戏

## 开发说明

### 代码规范

- 遵循PEP8代码风格
- 模块化设计，职责分离
- 关键算法有详细注释

### 主要模块说明

1. `app.py`: Gradio界面定义和事件绑定
2. `backend.py`: 后端逻辑封装和数据接口
3. `scripts/game_state.py`: 核心游戏逻辑和状态管理
4. `scripts/news_system.py`: 新闻生成和管理系统
5. `scripts/player_manager.py`: 玩家数据结构定义

## 常见问题

### 无法开始游戏？

确保有玩家注册后再点击"强制开始游戏"按钮。

### 调试功能无效？

检查是否在正确的游戏阶段使用调试功能，部分功能仅在特定阶段可用。

### 新闻系统API连接超时？

这是正常现象，系统设置了1秒的超时时间以避免影响游戏体验。超时后会自动使用备用的新闻模板。

## 版权信息

本项目仅供学习交流使用，不构成任何投资建议。
